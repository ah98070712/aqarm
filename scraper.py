from selenium import webdriver\nfrom selenium.webdriver.edge.service import Service as EdgeService\nfrom selenium.webdriver.edge.options import Options as EdgeOptions\nimport re\nimport datetime\nimport os\nimport time\n\ndef setup_driver():\n    options = EdgeOptions()\n    options.use_chromium = True\n    options.headless = True\n    # Modify executable path if necessary. See setup in workflow for exact location\n    service = EdgeService(executable_path='/usr/bin/msedge')\n    driver = webdriver.Edge(service=service, options=options)\n    return driver\n\ndef scrape_data(driver, page_id):\n    url = f'https://aqarmap.com.eg/ar/listing/{page_id}-a/'\n    try:\n        driver.get(url)\n        return driver.page_source\n    except Exception as e:\n        print(f'Error fetching {url}:', e)\n    return ''\ndef extract_contacts(page_content):\n    phones = set(re.findall(r'\b\d{11}\b', page_content))\n    emails = set(re.findall(r'[a-zA-Z0-9.-]+@[a-zA-Z0-9.-]+', page_content))\n    return phones, emails\n\ndef save_results(phones, emails):\n    timestamp = datetime.datetime.now().strftime('%Y-%m-%d-%H-%M-%S')\n    os.makedirs('results', exist_ok=True)\n    with open(f'results/{timestamp}_phones.txt', 'w') as phone_file:\n        phone_file.write('\n'.join(sorted(phones)))\n    with open(f'results/{timestamp}_emails.txt', 'w') as email_file:\n        email_file.write('\n'.join(sorted(emails)))\n\nif __name__ == '__main__':\n    driver = setup_driver()\n    all_phones = set()\n    all_emails = set()\n    for i in range(1, 1001):\n        print(f'Scraping page {i}...')\n        content = scrape_data(driver, i)\n        if content:\n            phones, emails = extract_contacts(content)\n            all_phones.update(phones)\n            all_emails.update(emails)\n            print(f'Page {i}: Found {len(phones)} phone numbers and {len(emails)} emails.')\n        else:\n            print(f'Page {i}: No content found.')\n    save_results(all_phones, all_emails)\n    driver.quit()\n    print('Scraping complete. Results have been saved.')\n
